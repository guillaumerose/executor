#!/bin/bash

if [ -z "$1" ]; then
  action="upload"
else
  action="download"
fi
#["serverwyq"]="10.4.224.236"
declare -a hosts
hosts=(
#"10.4.253.35" #["yf-mos-test-host02"]=
"10.168.222.236"
# "10.127.10.234"
)

#pro_dir='~/project/cloud/meituan/server/clouds'
#dis_dir='/home/wyq/Download/cloud/meituan/server/clouds/'

if [[ $action == "upload" ]]; then
   prompt=""
   for host in "${!hosts[@]}"; do
       echo $hosts
       prompt+="$hosts"
   done
   prompt="The hosts you are going to \033[32m upload \033[0m to:\033[32m $prompt \033[0m"
   echo -e $prompt
   read -p "Continue (y/n)" answer
   if [[ ! $answer =~ ^(y|Y|c)$ ]]; then
       exit 1
   fi
   for host in "${!hosts[@]}"; do
       echo $host ${hosts["$host"]}
       rsync -av --exclude '_output/bin/' /Users/yaoqiwan/go/src/yunion.io/x/executor/ yunion@${hosts["$host"]}:/home/yunion/go/src/yunion.io/x/executor/ --delete
       #rsync -av ~/project/onecloud/pkg/ yunion@${hosts["$host"]}:/home/yunion/go/src/yunion.io/x/onecloud/pkg/
       #rsync -av ~/project/onecloud/vendor/ yunion@${hosts["$host"]}:/home/yunion/go/src/yunion.io/x/onecloud/vendor
       #rsync -av -e 'ssh -p 44392' --exclude '*.pyc' ~/project/cloud/meituan/ sankuai@${hosts["$host"]}:/opt/cloud/meituan/
       
   done
elif [[ $action == "download" ]]; then
   prompt=""
   for host in "${!hosts[@]}"; do
       echo $hosts
       prompt+="$hosts"
   done
   prompt="The hosts you are going to \033[32m download \033[0m from:\033[32m $prompt \033[0m"
   echo -e $prompt
   read -p "Continue (y/n)" answer
   if [[ ! $answer =~ ^(y|Y)$ ]]; then
       exit 1
   fi
   for host in "${!hosts[@]}"; do
       echo $host ${hosts["$host"]}
       #rsync -av -e 'ssh -p 22222' --exclude '*.pyc' wyq@${hosts["$host"]}:/home/wyq/Download/cloud/meituan/server/clouds/ ~/project/cloud/meituan/server/clouds/
       
   done
fi
